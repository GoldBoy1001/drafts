(()=>{"use strict";function t(){const t=document.querySelector(".favourites-num"),e=JSON.parse(localStorage.getItem("favorites"))||[];e.length>0?(t.style.display="flex",t.textContent=e.length):t.style.display="none"}function e(){const t=document.querySelector(".cart-num"),e=JSON.parse(localStorage.getItem("cartItems"))||[];e.length>0?(t.style.display="flex",t.textContent=e.length):t.style.display="none"}class n{constructor(t){this.container=document.querySelector(t),this.defaultLimit=12}toggleCardExpansion(){this.container.classList.toggle("visible")}showLoadingMessage(){this.container.innerHTML="Loading..."}async fetchData(t=this.defaultLimit){try{this.showLoadingMessage();const e=await fetch(`https://fakestoreapi.com/products?limit=${t}`),n=await e.json();this.renderCards(n)}catch(t){console.error("Error fetching data:",t),this.container.innerHTML="Error fetching data"}}renderCards(t){this.container.innerHTML="",t.forEach((t=>{const e=this.createCard(t);this.container.appendChild(e)}))}createCard(n){const a=JSON.parse(localStorage.getItem("cartItems"))||[],o=n.id,c=a.findIndex((t=>t.id===o)),s=(JSON.parse(localStorage.getItem("favorites"))||[]).findIndex((t=>t.id===o)),i=document.createElement("div");i.className="card__body";const r=document.createElement("div");r.className="card",r.addEventListener("click",(()=>{this.toggleCardExpansion(r)}));const d=document.createElement("div");d.className="card__image";const l=document.createElement("img");l.className="card__img",l.src=n.image,l.alt="img";const u=document.createElement("div");u.className="card__price",u.textContent=`${n.price} ₽`;const m=document.createElement("img");m.className="card__price-img",m.src=-1!==s?"../../img/like-heart.svg":"../../img/heart-black-shape.svg",m.alt="heart",u.appendChild(m),m.addEventListener("click",(e=>{e.stopPropagation(),this.addToFavorites(n),t(),m.src=this.isProductInFavorites(n)?"../../img/like-heart.svg":"../../img/heart-black-shape.svg"}));const g=document.createElement("div");g.className="card__rate";const p=document.createElement("span");p.className="card__rate-num",p.textContent=n.rating.rate;const v=document.createElement("img");v.src="https://cdn-icons-png.flaticon.com/128/149/149763.png",v.alt="starfill";const f=document.createElement("span");f.className="card__rate-text",f.textContent="14 отзывов",g.appendChild(p),g.appendChild(v),g.appendChild(f);const h=document.createElement("div");h.className="card__category",h.textContent=n.category;const _=document.createElement("p");_.className="card__descriptions",_.textContent=n.description;const y=document.createElement("span");return y.className="card__btn",y.textContent=-1!==c?"Добавлен в корзину":"В корзину",y.addEventListener("click",(t=>{t.target.textContent="Добавлен в корзину"})),y.addEventListener("click",(t=>{t.stopPropagation(),this.addToCart(n),e()})),d.appendChild(l),r.appendChild(d),r.appendChild(u),r.appendChild(g),r.appendChild(h),r.appendChild(_),r.appendChild(y),i.appendChild(r),i}isProductInFavorites(t){const e=JSON.parse(localStorage.getItem("favorites"))||[],n=t.id;return e.some((t=>t.id===n))}toggleCardExpansion(t){const e=t.classList.contains("visible");this.container.querySelectorAll(".card").forEach((t=>{t.classList.remove("visible")})),e||t.classList.add("visible")}addToCart(t){const e=t.id,n=JSON.parse(localStorage.getItem("cartItems"))||[];n.find((t=>t.id===e))||(n.push({...t,quantity:1}),localStorage.setItem("cartItems",JSON.stringify(n)))}addToFavorites(t){const e=JSON.parse(localStorage.getItem("favorites"))||[],n=t.id,a=e.findIndex((t=>t.id===n));-1!==a?e.splice(a,1):e.push(t),localStorage.setItem("favorites",JSON.stringify(e))}}function a(){const t=document.querySelector(".cart"),n=document.querySelector(".title-1"),o=JSON.parse(localStorage.getItem("cartItems"))||[],c=t.querySelector(".cart-products");c.innerHTML="",0===o.length&&(t.innerHTML="",n.textContent="В корзине нет товаров"),c.addEventListener("click",(t=>{t.target.closest(".delete-button")&&function(t){const e=JSON.parse(localStorage.getItem("cartItems"))||[],n=e.findIndex((e=>e.id===parseInt(t)));-1!==n&&(e.splice(n,1),localStorage.setItem("cartItems",JSON.stringify(e)),a())}(t.target.closest(".delete-button").dataset.productId)})),o.forEach((t=>{const e=`\n\t  <section class="product">\n\t\t <div class="product__img">\n\t\t\t<img src="${(n=t).image}" alt="${n.title}">\n\t\t </div>\n\t\t <div class="product__title">${n.title}</div>\n\t\t <div class="product__count">\n\t\t\t<div class="count" data-count-id="${n.id}">\n\t\t\t  <div class="count__box">\n\t\t\t\t <input type="number" class="count__input" min="1" max="${n.rating.count}" value="${n.quantity}">\n\t\t\t  </div>\n\t\t\t  <div class="count__controls">\n\t\t\t\t <button type="button" class="count__up">\n\t\t\t\t\t<img src="../../img/icon-up.svg" alt="Increase">\n\t\t\t\t </button>\n\t\t\t\t <button type="button" class="count__down">\n\t\t\t\t\t<img src="../../img/icon-down.svg" alt="Decrease">\n\t\t\t\t </button>\n\t\t\t  </div>\n\t\t\t</div>\n\t\t </div>\n\t\t <div class="product__price">${n.price*n.quantity} $</div>\n\t\t <div class="product__controls">\n\t\t\t<button type="button" class="delete-button" data-product-id="${n.id}">\n\t\t\t  <img src="../../img/cross.svg" alt="Delete">\n\t\t\t</button>\n\t\t </div>\n\t  </section>\n\t`;var n;c.insertAdjacentHTML("beforeend",e)})),function(t){const e=document.querySelector(".cart-footer");if(e){const n=t.reduce(((t,e)=>t+e.quantity),0),a=t.reduce(((t,e)=>t+e.quantity*e.price),0);e.querySelector(".cart-footer__count").textContent=`${n} единиц`,e.querySelector(".cart-footer__price").textContent=`${a} $`}}(o),e()}const o=new n(".catalog__cards");function c(){const e=document.querySelector(".favourites"),n=document.querySelector(".title-2"),a=JSON.parse(localStorage.getItem("favorites"))||[],i=e.querySelector(".favorites-cart-products");i.innerHTML="",0===a.length&&(e.innerHTML="",n.textContent="Пусто"),i.addEventListener("click",(t=>{if(t.target.closest(".add-cart")){const e=t.target.closest(".add-cart").dataset.productId,n=function(t){return(JSON.parse(localStorage.getItem("favorites"))||[]).find((e=>e.id===parseInt(t)))}(e);o.addToCart(n),s(e),c()}})),i.addEventListener("click",(t=>{t.target.closest(".delete-favourites")&&s(t.target.closest(".delete-favourites").dataset.productId)})),a.forEach((t=>{const e=`\n\t<section class="favourites-product">\n\t<div class="favourites-product__img"><img src="${(n=t).image}" alt="Apple MacBook Air 13"></div>\n\t<div class="favourites-product__title">${n.title}</div>\n\t<div class="favourites-product__count">\n\t${n.description}\n\t</div>\n\t<div class="favourites-product__price">${n.price} $</div>\n\t<div class="favourites-product__controls">\n\t\t <button type="favourites-button"  class="delete-favourites" data-product-id="${n.id}">\n\t\t\t  <img src="./img/like-heart.svg" alt="Delete">\n\t\t </button>\n\t\t <button type="favourites-button" class="add-cart" data-product-id="${n.id}">\n\t\t  <img src="./img/shop-cart.svg" alt="Delete">\n\t\t </button>\n\t</div>\n</section>\n\t`;var n;i.insertAdjacentHTML("beforeend",e)})),t()}function s(t){const e=JSON.parse(localStorage.getItem("favorites"))||[],n=e.findIndex((e=>e.id===parseInt(t)));-1!==n&&(e.splice(n,1),localStorage.setItem("favorites",JSON.stringify(e)),c())}const i=document.querySelector(".catalog__btn"),r=window.location.href.endsWith("basket.html"),d=window.location.href.endsWith("favourites.html");if(!r&&!d){!function(){const t=document.querySelector(".menu-br__list"),e=document.querySelectorAll(".menu-br__item");t.addEventListener("click",(t=>{t.target.closest(".menu-br__list")&&(e.forEach((t=>{t.classList.remove("active-menu")})),t.target.classList.add("active-menu"))}))}(),function(){const t=document.querySelector(".body__burger"),e=document.querySelector(".menu-br"),n=document.querySelector(".main__slider"),a=document.querySelector(".swiper-right");function o(){const t=window.innerWidth;t>641&&(a.style.display="grid"),t<641?a.style.display="none":e.classList.contains("menu-br-hidden")||(a.style.display="none")}window.addEventListener("resize",o),o(),t.addEventListener("click",(t=>{t.target.closest(".body__burger")&&(e.classList.toggle("menu-br-hidden"),n.classList.toggle("main__slider-togle"),window.innerWidth>=641&&(a.style.display=e.classList.contains("menu-br-hidden")?"grid":"none"))}))}();const l=new n(".catalog__cards");l.fetchData(),i.addEventListener("click",(async t=>{t.preventDefault();let e=!1;if(!e){e=!0;try{"Все товары"===i.textContent?(await l.fetchData(""),i.textContent="Закрыть"):(await l.fetchData("12"),i.textContent="Все товары")}catch(t){console.error("Error fetching data:",t)}finally{e=!1}}}));let u=new Swiper(".my-swiper",{touchRatio:.5,touchAngle:45,navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}}),m=new Swiper(".swiper-right",{direction:"vertical",slidesPerView:2,spaceBetween:30,touchRatio:.5,touchAngle:45,breakpoints:{320:{spaceBetween:15},679:{spaceBetween:20},859:{spaceBetween:30}}});m.controller.control=u,u.controller.control=m,document.addEventListener("DOMContentLoaded",(function(){const t=document.querySelector(".assortment__text");document.querySelector(".read-more-btn").addEventListener("click",(function(){t.classList.toggle("collapsed"),t.classList.toggle("expanded")}))}))}if(window.location.href.endsWith("basket.html")){function g(t,e){const n=JSON.parse(localStorage.getItem("cartItems"))||[],o=n.findIndex((e=>e.id===parseInt(t)));-1!==o&&(n[o].quantity=e,localStorage.setItem("cartItems",JSON.stringify(n)),a())}a(),document.addEventListener("click",(t=>{const e=t.target.closest(".count");if(e){const n=e.querySelector(".count__input"),a=e.dataset.countId;let o=parseInt(n.value);t.target.closest(".count__up")?o+=1:t.target.closest(".count__down")&&o>1&&(o-=1),n.value=o,g(a,o)}}))}window.location.href.endsWith("favourites.html")&&c(),e(),t(),function(t){let e=new Image;e.onload=e.onerror=function(){!function(t){let e=!0===t?"webp":"no-webp";document.documentElement.classList.add(e)}(2==e.height)},e.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"}()})();